<html>
<head>
	<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.js"></script>
	<script src="js/coords.js"></script>
	<script src="js/leaflet.hotline.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.css" />
	<style>		
		#map {width: 100%; height: 100%; padding: 0px; margin: 0px; }
	</style>
</head>
<body>
	<div id="map"></div>
	<script>
		var tiles = L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png');
		var map = L.map('map', {layers: [tiles], scrollWheelZoom: true, dragging: true, tap: false });		
		var hash = window.location.hash.substr(1);
		if (hash != '' && hash.length == 4)
		{		
			// https://allorigins.win/
			var url = 'http://xtrex.ru/json/' + hash + '.json';
			$.getJSON('https://api.allorigins.win/get?url=' + encodeURIComponent(url), function (data) 
			{
			   var jObj = JSON.parse(data.contents).tracks;
			   var pts = JSON.parse(data.contents).tracks[0].points;
			   
			   coords = [];
			   for (let i = 0; i < pts.length; i++)
			   {
					if(coords.length < 4) coords.push([pts[i][0],pts[i][1],0]);
					else coords.push([pts[i][0],pts[i][1],pts[i][4]]);
			   };
			   
			   var hotlineLayer = L.hotline(coords, { min: 0, max: 150,
				  palette: { 0.0: '#6F4E37', 0.2: '#FFDB5C', 0.4: '#9DDE8B', 0.5: '#40A578', 0.6: '#399918', 0.7: '#FF7EE2', 0.8: '#FF4191', 0.9: '#E90074', 1.0: '#ff0000' },
				  weight: 8, outlineColor: '#000000', outlineWidth: 1
			   });
				
			   var bounds = hotlineLayer.getBounds();
			   map.fitBounds(bounds);
			   hotlineLayer.addTo(map);
				
			   L.circleMarker([coords[0][0], coords[0][1]], { radius: 10, fillColor: '#600000', fillOpacity: 1,  color: '#fff', weight: 2, }).addTo(map);
			   L.circleMarker([coords[coords.length-1][0], coords[coords.length-1][1]], { radius: 10, fillColor: '#009000', fillOpacity: 1,  color: '#fff', weight: 2, }).addTo(map);
			});
		};
	</script>
</body>
</html>